(()=>{var M=Object.defineProperty,Q=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var H=(e,t,n)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,f=(e,t)=>{for(var n in t||(t={}))X.call(t,n)&&H(e,n,t[n]);if(F)for(var n of F(t))Y.call(t,n)&&H(e,n,t[n]);return e},g=(e,t)=>Q(e,L(t));function m(){console.log("%c.io","background:#444;color:#fd890d;border-radius:4px;padding:2px",...arguments)}var Z="v04.02.2",K=1200,R=!1;async function y(e,t={}){let{timeout:n=K}=t,s=new AbortController,i=setTimeout(()=>s.abort(),n),o=await fetch(e,g(f({},t),{signal:s.signal}));return clearTimeout(i),o}function x(e){return e?e.includes("<html")?e:`<html lang="en"><body style="margin:0;background-color:#FFF">${e}</body></html>`:null}function S(e,t){var s,i,o;let n=e.ortbConverter({}).toORTB({bidRequests:[t],bidderRequest:e.bidderRequest});if(e.consent&&e.deepSetValue&&(e.deepSetValue(n,"user.ext.consent",(s=e==null?void 0:e.consent)==null?void 0:s.tcString),e.deepSetValue(n,"regs.ext.gdpr",(i=e==null?void 0:e.consent)!=null&&i.gdprApplies?1:0)),(o=n.imp)!=null&&o.length)for(let r of n.imp)r.banner.w=t.sizes[0][0],r.banner.h=t.sizes[0][1];return n}function b(e,t,n=null){var o,r;if(!((o=e==null?void 0:e.seatbid)!=null&&o.length))return null;let s=e.seatbid[0].bid.filter(a=>a&&a.price>0&&a.adm&&a.w===t.width&&a.h===t.height);s.sort((a,c)=>c.price-a.price);let i=s[0];return i!=null&&i.price&&fetch(),{cpm:(i==null?void 0:i.price)||0,currency:"USD",ad:x((i==null?void 0:i.adm)||null),size:{width:(i==null?void 0:i.w)||t.width,height:(i==null?void 0:i.h)||t.height},ssp:n,adomain:(r=i==null?void 0:i.adomain)!=null&&r.length?i.adomain[0]:null}}async function q(){return new Promise(e=>{window.__tcfapi?window.__tcfapi("getTCData",2,(t,n)=>{e(n?t:null)}):e(null)})}async function ee(e){try{return await fetch(`${e.static_url}/placements/info?ids=`+e.bidRequests.map(t=>t==null?void 0:t.params.placementId).join(",")).then(t=>t.json())}catch(t){return null}}async function te({base_url:e,size:t,placement_id:n,bidRequest:s,bidderRequest:i}){e||(e="https://lucead.com");let o=e.endsWith("lucead.com")?"https://ayads.io":e,r={seller:o,decisionLogicUrl:`${o}/js/ssp.js`,interestGroupBuyers:[o],auctionSignals:{size:t,placement_id:n},sellerSignals:{},sellerTimeout:1e3,sellerCurrency:"EUR",perBuyerSignals:{[o]:{prebid_bid_id:s.bidId,prebid_request_id:i.bidderRequestId}},perBuyerTimeouts:{"*":1e3},resolveToConfig:!1,dataVersion:2},a;if(!navigator.runAdAuction||location.hash.includes("skip-pa")?a=null:a=await navigator.runAdAuction(r),m("PAAPI",n,a),a){if(R){let c=document.createElement("iframe");c.src=a,c.style.display="none",document.body.appendChild(c),c.remove()}return{bid_id:s.bidId,ad:x(`<iframe src="${a}" style="width:${t.width}px;height:${t.height}px;border:none" seamless ></iframe>`),size:t,is_pa:!0}}else return null}async function ne(e){let t=e.placements_info;return await Promise.all(e.bidRequests.map(async n=>{var o,r,a,c,d,w,l,O,T,N,U,A,C,P,j,J,V,z,G,D,W,B,E;let s={bid_id:n.bidId,bid:0,ad:null,size:null};if(((o=n==null?void 0:n.params)==null?void 0:o.enableContextual)===!1)return s;let i={width:n.sizes[0][0]||300,height:n.sizes[0][1]||250};try{let p=(r=n==null?void 0:n.params)==null?void 0:r.placementId;if(!p)return s;let $=await te(g(f({},e),{size:i,placement_id:p,data:e,bidRequest:n}));if($)return $;if(!((a=t[p])!=null&&a.ssps))return m("No placement info",p,t),s;let h=[];if((d=(c=t[p])==null?void 0:c.ssps)!=null&&d.improve&&h.push(re(g(f({},e),{size:i,placement_id:(l=(w=t[p])==null?void 0:w.ssps)==null?void 0:l.improve,data:e,bidRequest:n}))),(T=(O=t[p])==null?void 0:O.ssps)!=null&&T.grid&&h.push(oe(g(f({},e),{size:i,placement_id:(N=t[p])==null?void 0:N.ssps.grid,deepSetValue:e.deepSetValue,data:e,bidRequest:n}))),(A=(U=t[p])==null?void 0:U.ssps)!=null&&A.smart&&h.push(se(g(f({},e),{sizes:n.sizes,size:i,placement_id:(P=(C=t[p])==null?void 0:C.ssps)==null?void 0:P.smart,transaction_id:n.transactionId,bid_id:n.bidId,ad_unit_code:n.adUnitCode,deepSetValue:e.deepSetValue,data:e,bidRequest:n}))),(J=(j=t[p])==null?void 0:j.ssps)!=null&&J.pubmatic&&h.push(le(g(f({},e),{size:i,placement_id:(z=(V=t[p])==null?void 0:V.ssps)==null?void 0:z.pubmatic,transaction_id:n.transactionId,bid_id:n.bidId,ad_unit_code:n.adUnitCode,data:e,bidRequest:n}))),(D=(G=t[p])==null?void 0:G.ssps)!=null&&D.magnite&&h.push(ae(g(f({},e),{size:i,placement_id:(B=(W=t[p])==null?void 0:W.ssps)==null?void 0:B.magnite,ad_unit_code:n.adUnitCode,data:e,bidRequest:n}))),!h.length)return s;let u=await Promise.all(h);if(u===null||!(u!=null&&u.length))return m("No bids",p,u),s;if(u=u.filter(_=>_&&_.cpm),m("SSP Bids",p,u),u!=null&&u.length){(E=u[0])!=null&&E.is_pa||u.sort((v,I)=>((I==null?void 0:I.cpm)||0)-((v==null?void 0:v.cpm)||0));let _=u[0];return _.bid_id=n.bidId,_.size=i,_}else return s}catch(p){return console.error(p),s}}))}async function ie(e){m("Lucead for Prebid "+Z,e);let t=e.endpoint_url,n=e.request_id,[s,i]=await Promise.all([ee(e),q()]);e.consent=i,e.placements_info=s,performance.mark("lucead-start");let o=null;try{o=await ne(e)}catch(r){console.error(r)}performance.mark("lucead-end"),m("All responses",o,performance.measure("lucead-all-responses","lucead-start","lucead-end")),fetch(`${t}/prebid/pub`,{method:"POST",contentType:"text/plain",body:JSON.stringify({request_id:n,responses:o})}).catch(console.error)}var k=location.hash.includes("mock");async function re({data:e,bidRequest:t,prebid_version:n,size:s,placement_id:i}){var a,c;let o=k?"?mock=improve":"https://ad.360yield.com/pb",r=S(e,t);r.imp[0].ext.bidder={placementId:i||22511670},r.ext={improvedigital:{sdk:{name:"pbjs",version:n||"8.32.0"}}};try{performance.mark("lucead-improve-start");let d=await y(o,{method:"POST",contentType:"text/plain",body:JSON.stringify(r)});return d.status!==200||(d=await d.json(),!((c=(a=d==null?void 0:d.seatbid[0])==null?void 0:a.bid[0])!=null&&c.price))?null:(performance.mark("lucead-improve-end"),b(d,s,"improve"))}catch(d){return null}}async function oe({size:e,placement_id:t,data:n,bidRequest:s}){let i=k?"?mock=grid":"https://grid.bidswitch.net/hbjson",o=S(n,s);o.imp[0].tagid=t.toString();try{let r=await y(i,{method:"POST",contentType:"text/plain",body:JSON.stringify(o)});return r.status!==200?(m("Grid response not ok",r),null):(r=await r.json(),b(r,e,"grid"))}catch(r){return null}}async function se({placement_id:e,sizes:t,size:n,prebid_version:s,transaction_id:i,bid_id:o,ad_unit_code:r,consent:a}){let c="https://prg.smartadserver.com/prebid/v1",d=e.toString().split(":").map(l=>parseInt(l));if(d.length<3)return null;let w={siteid:d[0]||351627,pageid:d[1]||1232283,formatid:d[2]||88269,ckid:d[3]||0,tagId:r,pageDomain:location.href,transactionId:i,timeout:3e3,bidId:o,prebidVersion:s||"8.37.0",schain:pbjs.getConfig("schain"),gpid:r,sizes:t.map(l=>({w:l[0],h:l[1]})),bidfloor:0,gdpr_consent:(a==null?void 0:a.tcString)||null};try{let l=await y(c,{method:"POST",contentType:"text/plain",body:JSON.stringify(w)});return!l.ok||l.status!==200||l.headers.get("content-length")==="0"?(m("Response not ok",l),null):(l=await l.json(),l?{cpm:(l==null?void 0:l.cpm)||0,currency:(l==null?void 0:l.currency)||"USD",ad:l!=null&&l.ad?x(l.ad):null,size:{width:l.width||n.width,height:l.height||n.height},ssp:"smart"}:null)}catch(l){return null}}async function le({placement_id:e,size:t,data:n,bidRequest:s}){let i=k?"?mock=pubmatic":"https://hbopenbid.pubmatic.com/translator?source=prebid-client",o=S(n,s);o.at=1,o.cur=["USD","EUR"],o.imp[0].tagid=e.toString();try{let r=await y(i,{method:"POST",contentType:"text/plain",body:JSON.stringify(o)});return r.ok?(r=await r.json(),b(r,t,"pubmatic")):(m("Response not ok",r),null)}catch(r){return null}}async function ae({placement_id:e,size:t,ad_unit_code:n,data:s,bidRequest:i}){let o=k?"?mock=magnite":"https://prebid-server.rubiconproject.com/openrtb2/auction",r=e.toString().split(":").map(c=>parseInt(c));if(r.length<3)return null;let a=S(s,i);a.imp[0].ext.prebid={bidder:{rubicon:{video:{},accountId:r[0],siteId:r[1],zoneId:r[2]}},adunitcode:n};try{let c=await y(o,{method:"POST",contentType:"text/plain",body:JSON.stringify(a)});return c.ok?(c=await c.json(),b(c,t,"magnite")):null}catch(c){return null}}window.ayads_prebid=ie;window.ayads_prebid_data&&(window.ayads_prebid(window.ayads_prebid_data),delete window.ayads_prebid_data);})();
